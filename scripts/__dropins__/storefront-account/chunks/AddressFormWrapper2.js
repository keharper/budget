import{jsx as a,Fragment as H,jsxs as O}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as Z,useState as y,useEffect as U,useCallback as M}from"@dropins/tools/preact-hooks.js";import{useText as q}from"@dropins/tools/i18n.js";import{classes as S,Slot as P}from"@dropins/tools/lib.js";import{memo as C,useCallback as L}from"@dropins/tools/preact-compat.js";import{Field as _,Picker as X,Input as j,InputDate as w,Checkbox as B,TextArea as Y,Skeleton as F,SkeletonRow as $,Card as J}from"@dropins/tools/components.js";const K=e=>e.reduce((d,p)=>({...d,[p.name]:p.value}),{}),Q=e=>/^\d+$/.test(e),ee=e=>/^[a-zA-Z0-9\s]+$/.test(e),re=e=>/^[a-zA-Z0-9]+$/.test(e),ae=e=>/^[a-zA-Z]+$/.test(e),te=e=>/^[a-z0-9,!\#\$%&'\*\+\/=\?\^_`\{\|\}~-]+(\.[a-z0-9,!\#\$%&'\*\+\/=\?\^_`\{\|\}~-]+)*@([a-z0-9-]+\.)+[a-z]{2,}$/i.test(e),le=e=>/^\d{4}-\d{2}-\d{2}$/.test(e)&&!isNaN(Date.parse(e)),ne=(e,d,p)=>{const s=new Date(e).getTime()/1e3;return isNaN(s)||s<0?!1:s>=d&&s<=p},W=e=>new Date(parseInt(e,10)*1e3).toISOString().split("T")[0],oe=e=>/^(https?|ftp):\/\/(([A-Z0-9]([A-Z0-9_-]*[A-Z0-9]|))(\.[A-Z0-9]([A-Z0-9_-]*[A-Z0-9]|))*)(:(\d+))?(\/[A-Z0-9~](([A-Z0-9_~-]|\.)*[A-Z0-9~]|))*\/?(.*)?$/i.test(e),de=(e,d,p)=>{const s=e.length;return s>=d&&s<=p},R=(e,d,p,s)=>{var V;const{requiredFieldError:n,lengthTextError:T,numericError:f,alphaNumWithSpacesError:l,alphaNumericError:m,alphaError:x,emailError:I,dateError:v,urlError:g,dateLengthError:r}=p,{validateRules:c,code:u,required:o}=d,t=u,A={[t]:""};if(s[t]&&delete s[t],o&&!e)return{[t]:n};if(!o&&!e||!c.length)return A;const i=K(c),h=i.MIN_TEXT_LENGTH??1,N=i.MAX_TEXT_LENGTH??255,D=i.DATE_RANGE_MIN,E=i.DATE_RANGE_MAX;if(!de(e,+h,+N)&&!(D||E))return{[t]:T.replace("{min}",h).replace("{max}",N)};if(!ne(e,+D,+E)&&(D||E))return{[t]:r.replace("{min}",W(D)).replace("{max}",W(E))};const k={numeric:{validate:Q,error:f},"alphanum-with-spaces":{validate:ee,error:l},alphanumeric:{validate:re,error:m},alpha:{validate:ae,error:x},email:{validate:te,error:I},date:{validate:le,error:v},url:{validate:oe,error:g}}[i.INPUT_VALIDATION];return k&&!k.validate(e)&&!((V=s[t])!=null&&V.length)?{[t]:k.error}:A},se=e=>e.reduce((d,{code:p,required:s,defaultValue:n})=>(s&&p&&(d[p]=n||""),d),{}),ce=({fieldsConfig:e,onSubmit:d,handleSetCountryCode:p,onChange:s})=>{const n=q({requiredFieldError:"Account.FormText.requiredFieldError",lengthTextError:"Account.FormText.lengthTextError",numericError:"Account.FormText.numericError",alphaNumWithSpacesError:"Account.FormText.alphaNumWithSpacesError",alphaNumericError:"Account.FormText.alphaNumericError",alphaError:"Account.FormText.alphaError",emailError:"Account.FormText.emailError",dateError:"Account.FormText.dateError",dateLengthError:"Account.FormText.dateLengthError",urlError:"Account.FormText.urlError"}),T=Z(null),[f,l]=y({}),[m,x]=y({}),[I,v]=y({previousCountryCode:null,previousRegionCode:null,initialLoad:!0});U(()=>{var A;const o=f.country_code,t=e==null?void 0:e.find(i=>i.code==="region");if(I.initialLoad)v(i=>({...i,previousCountryCode:o,initialLoad:!1}));else if(I.previousCountryCode!==o){v(h=>({...h,previousCountryCode:o}));const i=!((A=t==null?void 0:t.options)!=null&&A.length)&&!(t!=null&&t.defaultValue)||I.previousRegionCode?"":(t==null?void 0:t.defaultValue)??"";l(h=>({...h,region:i})),p(o)}t!=null&&t.defaultValue&&I.previousCountryCode===o&&v(i=>({...i,previousRegionCode:t.defaultValue}))},[e,f,I.previousCountryCode,I.initialLoad,I.previousRegionCode,p,l]),U(()=>{if(!(e!=null&&e.length))return;const o=se(e);l(o)},[e==null?void 0:e.length]);const g=M(o=>{const t=o.currentTarget,A=o.target,i=new FormData(t),h=Object.fromEntries(i.entries()),N={[A.name]:h[A.name]&&String(h[A.name])};s==null||s(h,N,o)},[s]),r=M(o=>{const{name:t,value:A,type:i,checked:h}=o==null?void 0:o.target,N=i==="checkbox"?h:A;l(E=>({...E,[t]:N}));const D=e.find(E=>E.id===t);if(D){const E={...m},b=R(N.toString(),D,n,E);b&&Object.assign(E,b),x(E)}},[m,e,n]),c=M(o=>{const{name:t,value:A,type:i,checked:h}=o==null?void 0:o.target,N=i==="checkbox"?h:A,D=e.find(E=>E.id===t);if(D){const E={...m},b=R(N.toString(),D,n,E);b&&Object.assign(E,b),x(E)}},[m,e,n]),u=M(o=>{o.preventDefault();let t=!0;const A={...m};let i=null;for(const[h,N]of Object.entries(f)){const D=e.find(b=>b.id===h),E=R(N.toString(),D,n,A);E[h]&&(Object.assign(A,E),t=!1),i||(i=Object.keys(A).find(b=>A[b])||null)}if(x(A),i&&T.current){const h=T.current.elements.namedItem(i);h==null||h.focus()}d==null||d(o,t)},[m,e,n,f,d]);return{formData:f,errors:m,formRef:T,handleInputChange:r,handleFormChange:g,handleBlur:c,handleSubmit:u}};var z=(e=>(e.BOOLEAN="BOOLEAN",e.DATE="DATE",e.DATETIME="DATETIME",e.DROPDOWN="DROPDOWN",e.FILE="FILE",e.GALLERY="GALLERY",e.HIDDEN="HIDDEN",e.IMAGE="IMAGE",e.MEDIA_IMAGE="MEDIA_IMAGE",e.MULTILINE="MULTILINE",e.MULTISELECT="MULTISELECT",e.PRICE="PRICE",e.SELECT="SELECT",e.TEXT="TEXT",e.TEXTAREA="TEXTAREA",e.UNDEFINED="UNDEFINED",e.VISUAL="VISUAL",e.WEIGHT="WEIGHT",e.EMPTY="",e))(z||{});const ie=C(({loading:e,values:d,fields:p=[],errors:s,className:n="",onChange:T,onBlur:f})=>{const l=`${n}__field`,m=L((r,c,u)=>a(_,{error:u,className:S([l,`${l}--${r.id}`,[`${l}--${r.id}-hidden`,r.isHidden],r.className]),"data-testid":`${n}--${r.id}`,disabled:e,children:a(X,{name:r.id,floatingLabel:`${r.label} ${r.required?"*":""}`,placeholder:r.label,"aria-label":r.label,options:r.options,onBlur:f,handleSelect:T,value:c||r.defaultValue})},r.id),[n,e,l,f,T]),x=L((r,c,u)=>a(_,{error:u,className:S([l,`${l}--${r.id}`,[`${l}--${r.id}-hidden`,r.isHidden],r.className]),"data-testid":`${n}--${r.id}`,disabled:e,children:a(j,{type:"text",name:r.id,value:c??r.defaultValue,placeholder:r.label,floatingLabel:`${r.label} ${r.required?"*":""}`,onBlur:f,onChange:T})},r.id),[n,e,l,f,T]),I=L((r,c,u)=>a(_,{error:u,className:S([l,`${l}--${r.id}`,[`${l}--${r.id}-hidden`,r.isHidden],r.className]),"data-testid":`${n}--${r.id}`,disabled:e,children:a(w,{type:"text",name:r.id,value:c||r.defaultValue,placeholder:r.label,floatingLabel:`${r.label} ${r.required?"*":""}`,onBlur:f,onChange:T})},r.id),[n,e,l,f,T]),v=L((r,c,u)=>a(_,{error:u,className:S([l,`${l}--${r.id}`,[`${l}--${r.id}-hidden`,r.isHidden],r.className]),"data-testid":`${n}--${r.id}`,disabled:e,children:a(B,{name:r.id,checked:c||r.defaultValue,placeholder:r.label,label:`${r.label} ${r.required?"*":""}`,onBlur:f,onChange:T})},r.id),[n,e,l,f,T]),g=L((r,c,u)=>a(_,{error:u,className:S([l,`${l}--${r.id}`,[`${l}--${r.id}-hidden`,r.isHidden],r.className]),"data-testid":`${n}--${r.id}`,disabled:e,children:a(Y,{type:"text",name:r.id,value:c??r.defaultValue,label:`${r.label} ${r.required?"*":""}`,onBlur:f,onChange:T})},r.id),[n,e,l,f,T]);return p.length?a(H,{children:p.map(r=>{const c=s==null?void 0:s[r.id],u=d==null?void 0:d[r.id];switch(r.fieldType){case z.TEXT:return r.options.length?m(r,u,c):x(r,u,c);case z.MULTILINE:return x(r,u,c);case z.SELECT:return m(r,u,c);case z.DATE:return I(r,u,c);case z.BOOLEAN:return v(r,u,c);case"TEXTAREA":return g(r,u,c);default:return null}})}):null}),Te=C(({slots:e,name:d,loading:p,children:s,className:n="defaultForm",fieldsConfig:T,onSubmit:f,handleSetCountryCode:l,onChange:m})=>{const{formData:x,errors:I,formRef:v,handleInputChange:g,handleFormChange:r,handleBlur:c,handleSubmit:u}=ce({fieldsConfig:T,onSubmit:f,handleSetCountryCode:l,onChange:m});return O("form",{className:S(["dropin-form",n]),onSubmit:u,onChange:r,name:d,ref:v,children:[a(ie,{className:n,loading:p,fields:T,onChange:g,onBlur:c,errors:I,values:x}),e!=null&&e.AddressFormInputs?a(P,{"data-testid":"addressFormInputs",name:"AddressFormInputs",slot:e.AddressFormInputs,context:{formActions:{handleChange:g}}}):null,s]})}),$e=({testId:e,withCard:d=!0})=>{const p=O(F,{"data-testid":e||"skeletonLoader",children:[a($,{variant:"heading",size:"xlarge",fullWidth:!1,lines:1}),a($,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1}),a($,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1})]});return d?p:a(J,{variant:"secondary",className:S(["dropin-account-loaders","dropin-account-loaders--card-loader"]),children:p})},me=()=>O(F,{"data-testid":"addressFormLoader",children:[a($,{variant:"heading",size:"medium"}),a($,{variant:"empty",size:"medium"}),a($,{size:"large"}),a($,{size:"large"}),a($,{size:"large",fullWidth:!0}),a($,{size:"large",fullWidth:!0,lines:3}),a($,{size:"large"}),a($,{size:"large"}),a($,{size:"large"}),a($,{size:"large"}),a($,{size:"large"}),a($,{size:"large"}),a($,{size:"large",fullWidth:!0})]}),Ie=e=>O(F,{...e,rowGap:"xsmall",className:S(["dropin-account-loaders","dropin-account-loaders--picker-loader"]),children:[a($,{variant:"heading",size:"xsmall"}),a($,{variant:"empty",size:"small"}),a($,{size:"small"})]}),G={entityType:"CUSTOMER_ADDRESS",isUnique:!1,options:[],multilineCount:0,validateRules:[],defaultValue:!1,fieldType:z.BOOLEAN,className:"",required:!1,orderNumber:90,isHidden:!1},De={...G,label:"Set as default shipping address",name:"default_shipping",id:"default_shipping",code:"default_shipping",customUpperCode:"defaultShipping"},Ne={...G,label:"Set as default billing address",name:"default_billing",id:"default_billing",code:"default_billing",customUpperCode:"defaultBilling"};export{me as A,$e as C,Te as F,Ie as P,Ne as a,De as d};
