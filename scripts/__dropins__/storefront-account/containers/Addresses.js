import{jsx as i,jsxs as C,Fragment as X}from"@dropins/tools/preact-jsx-runtime.js";import{classes as M}from"@dropins/tools/lib.js";import{C as K}from"../chunks/AddressFormWrapper2.js";import*as z from"@dropins/tools/preact-compat.js";import{useCallback as I,useMemo as Y}from"@dropins/tools/preact-compat.js";import{Card as j,Button as x,Tag as W,Icon as Z,Modal as D,ProgressSpinner as ee,Header as ie}from"@dropins/tools/components.js";import{Fragment as se}from"@dropins/tools/preact.js";import{useState as v,useCallback as h,useEffect as te}from"@dropins/tools/preact-hooks.js";import{u as q,g as re}from"../chunks/updateCustomerAddress.js";import"@dropins/tools/event-bus.js";import{e as de}from"../chunks/convertCase.js";import{g as ne,r as oe}from"../chunks/removeCustomerAddress.js";import{S as le,c as ae,E as ce}from"../chunks/checkIsFunction.js";import{A as H}from"../chunks/AddressFormWrapper.js";import{useText as S}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/transform-customer-address.js";const G=({minifiedView:t,keysSortOrder:n,addressData:e,loading:l,setAddressId:s,handleRenderModal:c,handleRenderForm:d})=>{const r={minifiedView:{},fullSizeView:{}};r.minifiedView=S({actionRemove:"Account.Addresses.minifiedView.addressCard.actionRemove",actionEdit:"Account.Addresses.minifiedView.addressCard.actionEdit",cardLabelShipping:"Account.Addresses.minifiedView.addressCard.cardLabelShipping",cardLabelBilling:"Account.Addresses.minifiedView.addressCard.cardLabelBilling"}),r.fullSizeView=S({actionRemove:"Account.Addresses.fullSizeView.addressCard.actionRemove",actionEdit:"Account.Addresses.fullSizeView.addressCard.actionEdit",cardLabelShipping:"Account.Addresses.fullSizeView.addressCard.cardLabelShipping",cardLabelBilling:"Account.Addresses.fullSizeView.addressCard.cardLabelBilling"});const p=I(()=>{s==null||s(e==null?void 0:e.id),c==null||c()},[c,e==null?void 0:e.id,s]),g=I(()=>{s==null||s(e==null?void 0:e.id),d==null||d()},[d,e==null?void 0:e.id,s]),w=Y(()=>{if(!n)return[];const{region:o,...u}=e,a={...u,...o};return n.filter(({name:m})=>a[m]).map(m=>({name:m.name,orderNumber:m.orderNumber,value:a[m.name],label:m.label}))},[e,n]);return i(j,{variant:"secondary",className:"dropin-address-card","data-testid":"addressCard",children:l?i(K,{}):C(X,{children:[C("div",{className:"dropin-address-card__action",children:[c?i(x,{variant:"tertiary",onClick:p,"data-testid":"removeButton",children:t?r.minifiedView.actionRemove:r.fullSizeView.actionRemove}):null,d?i(x,{variant:"tertiary",onClick:g,className:"dropin-address-card__action--editbutton","data-testid":"editButton",children:t?r.minifiedView.actionEdit:r.fullSizeView.actionEdit}):null]}),i("div",{className:"dropin-address-card__description",children:w.map((o,u)=>{const a=o.label?`${o.label}: ${o==null?void 0:o.value}`:o==null?void 0:o.value;return i("p",{"data-testid":`${o.name}_${u}`,children:a},u)})}),e!=null&&e.defaultShipping||e!=null&&e.defaultBilling?C("div",{className:"dropin-address-card__labels",children:[e!=null&&e.defaultShipping?i(W,{label:t?r.minifiedView.cardLabelShipping.toLocaleUpperCase():r.fullSizeView.cardLabelShipping.toLocaleUpperCase()}):null,e!=null&&e.defaultBilling?i(W,{label:t?r.minifiedView.cardLabelBilling.toLocaleUpperCase():r.fullSizeView.cardLabelBilling.toLocaleUpperCase()}):null]}):null]})})},ue=t=>z.createElement("svg",{id:"Icon_Add_Base","data-name":"Icon \\u2013 Add \\u2013 Base",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",...t},z.createElement("g",{id:"Large"},z.createElement("rect",{id:"Placement_area","data-name":"Placement area",width:24,height:24,fill:"#fff",opacity:0}),z.createElement("g",{id:"Add_icon","data-name":"Add icon",transform:"translate(9.734 9.737)"},z.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_579","data-name":"Line 579",y2:12.7,transform:"translate(2.216 -4.087)",fill:"none",stroke:"currentColor"}),z.createElement("line",{vectorEffect:"non-scaling-stroke",id:"Line_580","data-name":"Line 580",x2:12.7,transform:"translate(-4.079 2.263)",fill:"none",stroke:"currentColor"})))),me=({className:t,addNewAddress:n,minifiedView:e,routeAddressesPage:l})=>{const s={minifiedView:{},fullSizeView:{}};return s.minifiedView=S({viewAllAddressesButton:"Account.Addresses.minifiedView.viewAllAddressesButton"}),s.fullSizeView=S({addNewAddressButton:"Account.Addresses.fullSizeView.addNewAddressButton"}),C("button",{className:M(["dropin-actions-address",["dropin-actions-address--viewall",e],["dropin-actions-address--address",!e],t]),"data-testid":"showRouteFullAddress",onClick:l,children:[i("span",{className:"dropin-actions-address--title","data-testid":"addressActionsText",children:e&&!n?s.minifiedView.viewAllAddressesButton:s.fullSizeView.addNewAddressButton}),i(Z,{source:e&&!n?le:ue,size:"32"})]})},fe=({minifiedView:t,keysSortOrder:n,addressData:e,open:l,submitLoading:s,onRemoveAddress:c,closeModal:d})=>{const r={minifiedView:{},fullSizeView:{}};return r.minifiedView=S({title:"Account.Addresses.minifiedView.removeAddressModal.title",description:"Account.Addresses.minifiedView.removeAddressModal.description",actionCancel:"Account.Addresses.minifiedView.removeAddressModal.actionCancel",actionConfirm:"Account.Addresses.minifiedView.removeAddressModal.actionConfirm"}),r.fullSizeView=S({title:"Account.Addresses.fullSizeView.removeAddressModal.title",description:"Account.Addresses.fullSizeView.removeAddressModal.description",actionCancel:"Account.Addresses.fullSizeView.removeAddressModal.actionCancel",actionConfirm:"Account.Addresses.fullSizeView.removeAddressModal.actionConfirm"}),l?C(D,{title:i("h3",{children:t?r.minifiedView.title:r.fullSizeView.title}),className:"dropin-address-modal",size:"full","data-testid":"addressModal",showCloseButton:!0,onClose:d,children:[s?i("div",{className:"dropin-address-modal__spinner","data-testid":"progressSpinner",children:i(ee,{stroke:"4",size:"large"})}):null,i("p",{children:t?r.minifiedView.description:r.fullSizeView.description}),i(G,{minifiedView:t,addressData:e,keysSortOrder:n}),C("div",{className:"dropin-address-modal__wrapper--buttons",children:[i(x,{type:"button",onClick:d,variant:"secondary",disabled:s,children:t?r.minifiedView.actionCancel:r.fullSizeView.actionCancel}),i(x,{disabled:s,onClick:c,children:t?r.minifiedView.actionConfirm:r.fullSizeView.actionConfirm})]})]}):null},pe=async(t,n)=>{if(n.length===1){const d=n[0],p=Object.values(d.region).every(w=>!!w)?{}:{region:{...d.region,regionId:0}};return!!await q({addressId:Number(d==null?void 0:d.id),defaultShipping:!1,defaultBilling:!1,...p})}const e=n.filter(d=>d.id!==t&&(d.defaultBilling||d.defaultShipping)||d.id!==t),l=n[n.length-1],s=e[0]||((l==null?void 0:l.id)!==t?l:null);return!s||!s.id?!1:!!await q({addressId:+s.id,defaultShipping:!0,defaultBilling:!0})},Ae=["firstname","lastname","city","company","country_code","region","region_code","region_id","telephone","id","vat_id","postcode","street","street_2","default_shipping","default_billing"],we=({minifiedView:t,routeAddressesPage:n,onSuccess:e})=>{const[l,s]=v(!1),[c,d]=v(!1),[r,p]=v(!1),[g,w]=v(!1),[o,u]=v(!1),[a,m]=v(""),[_,N]=v([]),[T,E]=v([]),A=h(async()=>{p(!0),Promise.all([re("shortRequest"),ne()]).then(b=>{const[k,f]=b;if(k){const U=k.map(({name:y,orderNumber:J,label:Q})=>({name:de(y),orderNumber:J,label:Ae.includes(y)?null:Q}));E(U)}if(f)if(t){const U=f.filter(y=>!!y.defaultShipping||!!y.defaultBilling);N(U)}else N(f)}).finally(()=>{p(!1)})},[t]);te(()=>{A()},[A]);const V=h(b=>{m(b),u(!1)},[]),B=h(()=>{d(!0)},[]),L=h(()=>{m(""),d(!1),s(!1)},[]),O=h(()=>{s(!0)},[]),$=h(async()=>{w(!0),await pe(a,_),oe(+a).then(()=>{A(),L()}).finally(()=>{w(!1)})},[_,a,L,A]),F=h(()=>{u(!1)},[]),R=h(()=>{ae(n)&&t&&!o?window.location.href=n():(u(!0),m(""))},[o,n,t]),P=h(async()=>{await A(),await(e==null?void 0:e())},[A,e]);return{keysSortOrder:T,submitLoading:g,isModalRendered:l,isFormRendered:c,loading:r,addNewAddress:o,addressesList:_,addressId:a,handleRenderForm:B,handleRenderModal:O,removeAddress:$,onCloseBtnClick:L,setEditingAddressId:V,closeNewAddressForm:F,redirectToAddressesRoute:R,handleOnSuccess:P}},ge=({className:t,withHeader:n=!0,minifiedView:e=!1,withActionsInMinifiedView:l=!1,withActionsInFullSizeView:s=!0,inputsDefaultValueSet:c,showShippingCheckBox:d=!0,showBillingCheckBox:r=!0,shippingCheckBoxValue:p=!0,billingCheckBoxValue:g=!0,routeAddressesPage:w,onSuccess:o,onError:u})=>{const a={minifiedView:{},fullSizeView:{}};a.minifiedView=S({containerTitle:"Account.Addresses.minifiedView.containerTitle",editAddressFormTitle:"Account.Addresses.minifiedView.editAddressFormTitle",viewAllAddressesButton:"Account.Addresses.minifiedView.viewAllAddressesButton"}),a.fullSizeView=S({containerTitle:"Account.Addresses.fullSizeView.containerTitle",editAddressFormTitle:"Account.Addresses.fullSizeView.editAddressFormTitle",newAddressFormTitle:"Account.Addresses.fullSizeView.newAddressFormTitle",viewAllAddressesButton:"Account.Addresses.fullSizeView.viewAllAddressesButton"});const{keysSortOrder:m,submitLoading:_,isModalRendered:N,isFormRendered:T,loading:E,addNewAddress:A,addressesList:V,addressId:B,handleRenderForm:L,handleRenderModal:O,removeAddress:$,onCloseBtnClick:F,handleOnSuccess:R,setEditingAddressId:P,closeNewAddressForm:b,redirectToAddressesRoute:k}=we({minifiedView:e,routeAddressesPage:w,onSuccess:o});return C("div",{children:[i("div",{children:n?i(ie,{title:e?a.minifiedView.containerTitle:a.fullSizeView.containerTitle,divider:!e,className:e?"dropin-addresses-header":""}):null}),C("div",{className:M(["dropin-addresses-wrapper",t]),"data-testid":"addressesIdWrapper",children:[i(fe,{minifiedView:e,addressData:V.find(f=>f.id===B),keysSortOrder:m,submitLoading:_,open:N,closeModal:F,onRemoveAddress:$}),E?i(K,{testId:"addressSkeletonLoader",withCard:!1}):i(ce,{isEmpty:!V.length,typeList:"address",minifiedView:e}),V.map(f=>i(se,{children:B===f.id&&T?i(j,{variant:"secondary",style:{marginBottom:20},children:i(H,{isOpen:B===f.id&&T,addressFormId:B,inputsDefaultValueSet:f,addressesFormTitle:e?a.minifiedView.editAddressFormTitle:a.fullSizeView.editAddressFormTitle,showShippingCheckBox:d,showBillingCheckBox:r,shippingCheckBoxValue:p,billingCheckBoxValue:g,onCloseBtnClick:F,onSuccess:R,onError:u})}):i(G,{minifiedView:e,addressData:f,keysSortOrder:m,loading:E,setAddressId:P,handleRenderModal:e&&l||!e&&s?O:void 0,handleRenderForm:e&&l||!e&&s?L:void 0},f.id)},f.id)),i("div",{className:"dropin-addresses__footer",children:A?i("div",{className:M(["dropin-addresses-form__footer__wrapper",["dropin-addresses-form__footer__wrapper-show",A]]),children:i(j,{variant:"secondary",children:i(H,{isOpen:A,addressesFormTitle:a.fullSizeView.newAddressFormTitle,inputsDefaultValueSet:c,showShippingCheckBox:!!V.length,showBillingCheckBox:!!V.length,shippingCheckBoxValue:p,billingCheckBoxValue:g,onCloseBtnClick:b,onSuccess:R,onError:u})})}):i(me,{minifiedView:e,addNewAddress:A,routeAddressesPage:k})})]})]})},ke=({className:t,withHeader:n,minifiedView:e,withActionsInMinifiedView:l,withActionsInFullSizeView:s,inputsDefaultValueSet:c,showShippingCheckBox:d,showBillingCheckBox:r,shippingCheckBoxValue:p,billingCheckBoxValue:g,routeAddressesPage:w,onSuccess:o,onError:u})=>i("div",{className:M(["dropin-addresses",t]),"data-testid":"addressesid",children:i(ge,{className:t,withHeader:n,minifiedView:e,withActionsInMinifiedView:l,withActionsInFullSizeView:s,inputsDefaultValueSet:c,billingCheckBoxValue:g,shippingCheckBoxValue:p,showBillingCheckBox:r,showShippingCheckBox:d,routeAddressesPage:w,onSuccess:o,onError:u})});export{ke as Addresses,ke as default};
